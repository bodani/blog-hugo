---
title: "Patroni 高可用管理进阶"
date: 2021-03-05T17:06:18+08:00
draft: false
---

##### 完成目标

- 主从同步策略
- [异地多机房策略](postgres/patroni02/#异地多机房策略)
- API 访问认证
- DSC 访问认证
- watch-dog
- 配置文件详情
- DCS 失效处理
- 加入节点复制数据限流
- 级联复制
- 日志&监控

##### 异地多机房策略

- 备用机房节点在failover时不能选做主
- 备用机房节点主从复制采用异步方式

实现方法： 在yml 中的tag配置如下
```
tags: 
  nofailover: true
  nosync: true
```

```
patronictl -c /etc/patroni.yml list
+ Cluster: postgres (6935302809216505755) -----+----+-----------+------------------+
| Member      | Host       | Role    | State   | TL | Lag in MB | Tags             |
+-------------+------------+---------+---------+----+-----------+------------------+
| postgresql0 | 10.10.1.11 | Replica | running | 20 |         0 | nofailover: true |
|             |            |         |         |    |           | nosync: true     |
+-------------+------------+---------+---------+----+-----------+------------------+
| postgresql2 | 10.10.1.12 | Replica | running | 20 |         0 |                  |
+-------------+------------+---------+---------+----+-----------+------------------+
| postgresql3 | 10.10.1.13 | Leader  | running | 20 |           |                  |
+-------------+------------+---------+---------+----+-----------+------------------+
```
